# **스코어 기반 경로 탐색: 적대적 오토인코더 매니폴드에서의 신뢰할 수 있는 잠재 공간 탐색**

## **초록 (Abstract)**

GAN, VAE와 같은 생성 모델은 강력한 잠재 표현을 학습합니다. 하지만 표준적인 보간법(예: LERP, SLERP)을 통해 이 잠재 공간을 탐색하는 것은 종종 실패하며, 비현실적인 아티팩트(artifact)를 생성합니다. 이러한 실패는 단순한 기하학적 경로가 학습된 매니폴드의 저밀도 영역("구멍")을 통과하기 때문에 발생합니다. 우리는 보간 경로가 고밀도 매니폴드("population") 상에 머무르도록 보장하는 새로운 동적 경로 탐색 알고리즘을 제안합니다. 우리는 적대적 오토인코더(AAE) 프레임워크를 활용하는데, 이는 실제 데이터 매핑을 위한 인코더와 매니폴드의 밀도를 모델링하는 잠재 공간 판별자($D\_z$)를 유일하게 모두 제공합니다. 본 알고리즘은 매 스텝 두 가지 힘의 균형을 맞추며 경로를 반복적으로 계산합니다: (1) 목적지로 포인트를 끌어당기는 **목표 지향 힘**($\\vec{F}\_{\\text{target}}$)과 (2) 잠재 공간 판별자의 그래디언트(스코어)에서 파생된 **매니폴드 보정 힘**($\\vec{F}\_{\\text{correct}}$)입니다. 이 보정 힘은 매니폴드를 벗어난 포인트를 다시 "population"으로 밀어내는 복원력으로 작동합니다. 우리는 MNIST에 대한 실험을 통해, 제안하는 방법이 표준 보간법의 아티팩트를 성공적으로 피하면서 부드럽고 충실도 높은 시각적 변환을 생성함을 실증적으로 보여줍니다.

## **1\. 서론 (Introduction)**

생성 모델은 복잡한 데이터 분포를 학습하는 데 놀라운 성공을 보여주었습니다. 핵심 이점 중 하나는 데이터의 고수준 의미론적 속성을 종종 포착하는 학습된 잠재 공간($Z$)입니다. 예를 들어, 두 실제 이미지($x\_A$, $x\_B$)의 잠재 코드($z\_A$, $z\_B$) 사이를 보간하는 것처럼 이 공간을 탐색하는 것은 제어된 데이터 생성, 데이터 증강, 모델 표현 이해와 같은 작업을 위한 기본 기술입니다.

그러나 이 탐색의 신뢰성은 중요한 미해결 문제입니다. 가장 일반적인 방법인 선형 보간(LERP) 및 구면 선형 보간(SLERP)은 단순한 기하학적 연산입니다. 이 방법들은 암묵적으로 잠재 공간이 유클리드 공간이며 조밀하게 채워져 있다고 가정합니다. 이 가정은 결함이 있습니다. 생성기에 의해 학습된 실제 데이터 매니폴드는 종종 고차원 $Z$ 공간 내에 임베딩된 복잡한 저차원 구조입니다. 두 유효한 지점 $z\_A$와 $z\_B$ 사이의 공간은 "구멍", 즉 생성기가 전혀 학습하지 않은 저확률 밀도 영역일 수 있습니다. 이 구멍을 통과하면 $G(z\_{interp})$가 흐릿하거나, 왜곡되거나, 의미 없는 아티팩트인 이미지를 디코딩하게 됩니다.

이전 연구에서는 종종 리만 계량(Riemannian metrics)을 사용하여 "지오데식"(매니폴드 상의 최단 경로)을 찾는 방식으로 이 문제를 해결하려 시도했습니다. 이론적으로는 타당하지만, 이러한 방법은 매 스텝 생성기의 자코비안($J\_G$)에 접근해야 하므로 계산 비용이 엄청나게 높습니다.

우리는 다른 접근 방식을 제안합니다. 사전 계산된 지오데식을 찾는 대신, 매 스텝 매니폴드를 "감지"하고 경로를 수정하는 **동적 경로 탐색 알고리즘**을 제안합니다. 이러한 알고리즘의 핵심 요구 사항은 $z\_t$ 지점이 "매니폴드 위에 있는지"(population 내) 또는 "매니폴드를 벗어났는지"(구멍 속)를 보고할 수 있는 "센서"입니다.

우리는 이 작업에 가장 이상적인 아키텍처가 \*\*적대적 오토인코더(AAE)\*\*임을 발견했습니다. AAE는 오토인코더와 GAN의 강점을 결합합니다. 본 연구에서 결정적으로 중요한 점은 AAE가 다음 두 가지를 제공한다는 것입니다:

1. 실제 데이터 $x$를 잠재 공간 $z$로 매핑하여 $z\_A \= E(x\_A)$ 및 $z\_B \= E(x\_B)$를 찾을 수 있게 하는 **인코더**($E$).  
2. 사전 분포 $P(z)$의 "실제" 잠재 코드와 인코더 $E(x)$의 "가짜" 잠재 코드를 구별하도록 명시적으로 학습된 **잠재 공간 판별자**($D\_z$).

본 연구에서는 이 잠재 공간 판별자 $D\_z$를 "센서"로 용도를 변경합니다. 우리는 그 그래디언트(스코어)를 $z\_t$ 지점을 고밀도 매니폴드로 다시 밀어내는 **복원력**($\\vec{F}\_{\\text{correct}}$)의 기반으로 정의합니다. 우리 알고리즘은 이 복원력과 $z\_B$로 포인트를 끌어당기는 **목표 지향 힘**($\\vec{F}\_{\\text{target}}$)의 균형을 맞추며 경로를 반복적으로 업데이트합니다. 이 방법은 생성된 경로의 충실도를 보장하면서 잠재 공간을 탐색하는 계산적으로 효율적이고 신뢰할 수 있는 방법을 제공합니다.

## **2\. 관련 연구 (Related Work)**

본 연구는 세 가지 주요 연구 분야를 기반으로 합니다:

* **잠재 공간 보간법 (Latent Space Interpolation):** LERP와 SLERP는 단순성 때문에 여전히 일반적인 기준선으로 남아있습니다. StyleGAN에서는 초기 $Z$ 공간보다 더 분리된(disentangled) 중간 $W$ 공간에서 보간하는 것이 우수한 결과를 생성함을 보여주었습니다. 그러나 $W$ 공간 역시 저밀도 영역을 포함할 수 있으므로 "구멍" 문제를 근본적으로 해결하지는 못합니다.  
* **매니폴드 인지 탐색 (Manifold-Aware Traversal):** 가장 엄격한 접근 방식은 생성기의 가중치로 정의된 리만 매니폴드에서 지오데식을 계산하는 것입니다. 이는 잠재 공간의 휘어진 특성을 인정합니다. 그러나 생성기의 전체 자코비안을 포함하는 지오데식 미분 방정식을 푸는 계산 비용은 이 접근 방식을 대부분의 응용 분야에서 비실용적으로 만듭니다.  
* **스코어 기반 생성 및 개선 (Score-Based Generation and Refinement):** 확산 모델(Diffusion Models)은 *스코어 함수*($\\nabla\_x \\log p(x)$)가 노이즈에서 데이터 매니폴드로 샘플을 안내하는 힘을 입증했습니다. 유사하게, EBM(Energy-Based Models)이나 GAN과 함께 자주 사용되는 Langevin Dynamics는 판별자(또는 에너지 함수)의 그래디언트 $\\nabla\_x D(x)$를 사용하여 고차원 *픽셀 공간*에서 비현실적인 샘플을 *개선*합니다.

**본 연구의 위치:** 우리는 이러한 개념들을 연결합니다. 스코어 기반 안내 원칙을 적용하되, 계산 비용이 많이 드는 픽셀 공간($x$) 대신 \*\*저차원의 조밀한 잠재 공간($z$)\*\*에서 작동합니다. 우리는 AAE의 잠재 공간 판별자 $D\_z$를 잠재 매니폴드의 스코어 함수 $\\nabla\_z P(z)$에 대한 효율적인 프록시(proxy)로 사용합니다.

## **3\. 방법론 (Method)**

### **3.1. 적대적 오토인코더 (AAE)**

우리 방법은 사전 학습된 AAE에 의존하며, 이는 세 가지 구성 요소로 이루어집니다:

1. 입력 $x$를 잠재 벡터 $z \= E(x)$로 매핑하는 **인코더** $E(x)$.  
2. 입력을 $\\hat{x} \= G(z)$로 재구성하는 **디코더 (생성기)** $G(z)$.  
3. 인코더 $q(z) \= E(x)$의 $z$("가짜")와 사전 분포 $P(z)$에서 샘플링된 $z$("실제")를 구별하는 **잠재 공간 판별자** $D\_z(z)$.

모델은 재구성 손실($L\_{\\text{recon}} \= \\|x \- G(E(x))\\|^2$)과 집계된 사후 분포 $q(z)$가 사전 분포 $P(z)$(예: $\\mathcal{N}(0, I)$)와 일치하도록 강제하는 $D\_z$에 대한 적대적 손실($L\_{\\text{adv}}$)로 학습됩니다.

### **3.2. 에너지 최소값으로서의 매니폴드**

우리 알고리즘을 위해, AAE가 잘 학습되었다고 가정합니다. 이는 판별자 $D\_z$가 $P(z)$ 매니폴드("population")를 식별하는 방법을 학습했음을 의미합니다. (우리 실험에서 사용된 것과 같은) 일반적인 AAE에서 $D\_z$는 $z \\in P(z)$에 대해 로짓 $0$(확률 $0.5$)을 출력하고 $z \\notin P(z)$에 대해 0이 아닌 로짓을 출력하도록 학습됩니다.

따라서 판별자의 로짓 출력을 기반으로 "매니폴드 에너지" 함수 $E(z)$를 다음과 같이 정의할 수 있습니다:

$$E(z) \= (D\_z(z))^2$$  
학습된 "population" 매니폴드는 이 에너지가 전역 최소값인 지점들의 집합으로 정의됩니다:

$$\\mathcal{M} \= \\{ z \\in Z \\mid E(z) \= 0 \\}$$  
"매니폴드를 벗어난"("구멍" 속의) 모든 $z$는 $E(z) \> 0$ 값을 갖게 됩니다.

### **3.3. 스코어 기반 경로 최적화**

우리의 목표는 $z\_0 \= z\_A$에서 시작하여 $z\_T \\approx z\_B$에서 끝나는 경로 $(z\_0, z\_1, \\dots, z\_T)$를 찾는 것이며, 경로상의 모든 $z\_t$가 에너지 $E(z\_t)$를 최소화, 즉 $z\_t \\in \\mathcal{M}$이 되도록 하는 것입니다.

우리는 이것을 이산 최적화 문제로 공식화합니다. $z\_t$ 지점에서 다음 지점 $z\_{t+1}$은 두 가지 경쟁하는 힘에 의해 결정됩니다:

1. **목표 지향 힘 (**$\\vec{F}\_{\\text{target}}$**):** $z\_t$를 최종 목적지 $z\_B$로 직접 끌어당기는 벡터입니다. 스텝 크기 $\\alpha$로 스케일링된 단위 벡터로 정의합니다.

$$\\vec{F}\_{\\text{target}} \= \\alpha \\cdot \\frac{z\_B \- z\_t}{\\|z\_B \- z\_t\\|\_2}$$  

2. **보정 힘 (**$\\vec{F}\_{\\text{correct}}$**):** $E(z\_t)$ 에너지를 최소화하여 $z\_t$를 매니폴드 $\\mathcal{M}$ 위로 다시 밀어내는 복원력입니다. 이 힘은 에너지 함수의 \*\*그래디언트(스코어)\*\*에서 파생되며, $E(z\_t)$에 대한 그래디언트 하강(Gradient Descent)을 수행합니다.

$$\\vec{F}\_{\\text{correct}} \= \- \\beta \\cdot \\nabla\_{z\_t} E(z\_t) \= \- \\beta \\cdot \\nabla\_{z\_t} (D\_z(z\_t))^2$$

최종 업데이트 규칙은 이 두 힘을 결합합니다:

$$z\_{t+1} \= z\_t \+ \\vec{F}\_{\\text{target}} \+ \\vec{F}\_{\\text{correct}}$$  
여기서 $\\alpha$ (STEP\_SIZE)와 $\\beta$ (BETA)는 이동 속도와 매니폴드 준수 엄격성 사이의 균형을 맞추는 하이퍼파라미터입니다.

## **4\. 알고리즘 (Algorithms)**

전체 경로 탐색 과정은 알고리즘 1에 자세히 설명되어 있습니다.

## **알고리즘 1: 스코어 기반 매니폴드 탐색 (Score-Guided Manifold Walk)**

입력: 시작 데이터 $x\_A$, 종료 데이터 $x\_B$  
입력: 학습된 인코더 $E$, 학습된 디코더 $G$, 학습된 판별자 $D\_z$  
파라미터: 스텝 크기 $\\alpha$, 보정 강도 $\\beta$, 최대 스텝 $T\_{\\text{max}}$, 허용 오차 $\\epsilon$  
출력: 잠재 벡터 경로 $\\mathcal{P} \= (z\_0, z\_1, \\dots, z\_T)$  
1: $z\_A \\leftarrow E(x\_A)$  
2: $z\_B \\leftarrow E(x\_B)$  
3: $z\_0 \\leftarrow z\_A$  
4: $\\mathcal{P} \\leftarrow \[z\_0\]$  
5: for $t \= 0$ to $T\_{\\text{max}} \- 1$ do  
6: // \--- 종료 조건 확인 \---  
7: $d \\leftarrow \\|z\_B \- z\_t\\|\_2$  
8: if $d \< \\epsilon$ then  
9: break  
10: // \--- 1\. 목표 지향 힘 계산 \---  
11: $\\vec{v}\_{\\text{target}} \\leftarrow (z\_B \- z\_t) / (d \+ 1e-8)$  
12: $\\vec{F}\_{\\text{target}} \\leftarrow \\alpha \\cdot \\vec{v}\_{\\text{target}}$  
13:  
14: // \--- 2\. 보정 힘 계산 \---  
15: $z\_t.\\text{requires\\\_grad} \\leftarrow \\text{True}$  
16: $logit \\leftarrow D\_z(z\_t)$  
17: $E \\leftarrow (logit)^2$  
18: $E.\\text{backward}()$  
19: $\\vec{g} \\leftarrow z\_t.\\text{grad}$  
20: $\\vec{F}\_{\\text{correct}} \\leftarrow \- \\beta \\cdot \\vec{g}$  
21:  
22: // \--- 3\. 스텝 업데이트 \---  
23: $z\_{t+1} \\leftarrow z\_t.\\text{detach}() \+ \\vec{F}\_{\\text{target}} \+ \\vec{F}\_{\\text{correct}}$  
24: $\\mathcal{P}.\\text{append}(z\_{t+1})$  
25: end for  
26: return $\\mathcal{P}$

## **5\. 실험 (Experiments)**

우리는 MNIST 데이터셋에 AAE(Z\_DIM=16)를 학습시켜 우리 방법을 검증합니다. 우리의 \*\*Score-Guided Walk (SGW)\*\*를 기준선인 \*\*Linear Interpolation (LERP)\*\*과 비교합니다.

* **기준선 (LERP):** $z(t) \= (1-t)z\_A \+ t z\_B$ (단, $t \\in \[0, 1\]$)  
* **제안 (SGW):** 알고리즘 1에 의해 생성된 경로 $\\mathcal{P}$

### **5.1. 실험 1: 클래스 간 보간 ('7' $\\to$ '9')**

$x\_A$('7')와 $x\_B$('9') 두 이미지를 선택하고 LERP와 SGW를 사용하여 보간 경로를 계산합니다.

* **정성적 결과:** LERP 경로는 심각한 품질 저하를 보입니다. 변환 중간($t \\approx 0.5$)에 이미지가 흐릿해지며 숫자가 아닌 아티팩트가 됩니다. 반면, 우리의 SGW 경로는 '7'의 모양이 '9'로 논리적으로 "변형"되는 부드러운 시각적 전환을 보여주며, 모든 중간 프레임이 선명하고 숫자처럼 유지됩니다.  
* **정량적 결과:** 두 경로를 따라 $D\_z$ 확률 스코어(로짓의 시그모이드)를 플로팅합니다. LERP의 경우, 경로 중간에 스코어가 0.5 이하로 급격히 \*하락(dip)\*하며, 이는 저밀도 "구멍"을 통과함을 확인시켜줍니다. 우리의 SGW 경로의 경우, $D\_z$ 스코어는 0.5 평형점 근처에서 안정적으로 유지되며, 알고리즘이 경로를 매니폴드 위에 성공적으로 유지함을 확인시켜줍니다.

### **5.2. 실험 2: 클래스 내 보간 ('3' $\\to$ '3')**

서로 다른 필기 스타일을 나타내는 두 개의 *다른* '3' 이미지를 선택합니다.

* **정성적 결과:** LERP는 다시 품질 저하를 보이며, 경로 중간에 숫자가 희미해지거나 흐릿해집니다. 그러나 우리의 SGW 방법은 숫자의 정체성은 명확하게 유지하면서 *스타일* (예: '3'의 고리 모양 변화, 기울기 변화)의 명확하고 현실적인 전환을 보여줍니다.  
* **정량적 결과:** LERP의 $D\_z$ 스코어 플롯은 클래스 간 실험보다 덜 심각할 수 있지만 여전히 하락을 보입니다. SGW 스코어 플롯은 0.5 근처에서 안정적으로 유지됩니다.

## **6\. 결론 (Conclusion)**

표준적인 잠재 공간 보간 방법은 신뢰할 수 없습니다. 단순한 기하학적 경로가 종종 학습된 매니폴드의 저밀도 영역을 통과하여 아티팩트를 생성하기 때문입니다. 우리는 적대적 오토인코더의 잠재 공간 판별자를 활용하는 새로운 동적 경로 탐색 알고리즘인 SGW(Score-Guided Walk)를 제안했습니다. 판별자의 그래디언트를 복원력으로 사용하여, 우리 알고리즘은 매 스텝 경로를 동적으로 보정하여 고밀도 "population" 매니폴드 위에 머무르도록 보장합니다. MNIST 실험 결과, 이 방법은 계산적으로 효율적인 방식으로 "구멍" 문제를 효과적으로 해결하며 시각적으로 우수하고 충실도 높은 보간 결과를 생성함을 보여줍니다.

## **7\. 향후 연구 (Future Work)**

* **이론적 보장:** 우리 알고리즘은 탐욕적(greedy), 휴리스틱(heuristic) 접근 방식입니다. 향후 연구에서는 이 알고리즘이 매니폴드 $\\mathcal{M}$의 경계 $\\delta$-거리 내에 머무르면서 $z\_B$로 수렴함을 보장하는 이론적 조건을 탐색할 수 있습니다.  
* **고차원 데이터:** 이 방법의 확장성을 평가하기 위해 더 복잡하고 고해상도인 데이터셋(예: CelebA-HQ, LSUN)과 더 높은 차원의 잠재 공간($Z\_{\\text{dim}}=256$ 또는 $512$)에서 테스트해야 합니다.  
* **디코더 인지 보정:** 현재 방법은 $z \\in P(z)$만을 보장합니다. 여전히 디코더 $G$가 잘 학습되었음에 의존합니다. 가능한 확장으로는 \*픽셀 공간\* 판별자의 스코어($\\nabla\_z D\_x(G(z))$)를 통합하여 잠재 공간과 픽셀 공간의 충실도를 모두 확인하는 방법이 있습니다.  
* **분리된 탐색 (Disentangled Traversal):** 현재 경로는 "매니폴드 위"에 있지만 반드시 의미론적으로 "직선"이지는 않습니다. 이 방법은 단일 의미 속성의 변화에 해당하는 경로를 찾기 위해 분리(disentanglement) 기술과 결합될 수 있습니다.
